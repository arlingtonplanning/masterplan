<!DOCTYPE html>
<meta charset="utf-8">

<html>
<head>
<title>Arlington Age of Housing Stock</title>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://dimplejs.org/dist/dimple.v2.1.6.min.js"></script>

<style>
body {
    background-color: rgb(252,245,223);
}
p {
    font: 14px Arial,Helvetica,sans-serif;
    color: #545454;
	}
	
#BarChart {    
	float: right;
	top:10px;
	width: 100%;
	height: 350px;
}

</style>
</head>
<body>

<div id="BarChart"></div>

  <script type="text/javascript">
  //Start Bar Chart
        var svg = dimple.newSvg("#BarChart", "100%", "100%");
    d3.csv("https://raw.githubusercontent.com/arlingtonplanning/masterplan/gh-pages/housing/AgeofHousingStock.csv", function (data) {
      dimple.filterData(data, "Municipality");
	  BarChart.addCategoryAxis("x", ["Decade"]);
      BarChart.addMeasureAxis("y", "Percentage");
      BarChart.addSeries("Municipality", dimple.plot.bar);
      var BarLegend = BarChart.addLegend ("90%", "10%", "10%", "90%", "right");
	  BarLegend.fontSize = "auto";
		var LineStoryboard = BarChart.setStoryboard("Municipality");
		LineStoryboard.categoryFields = [null];
		BarChart.draw();
		LineStoryboard.storyLabel.remove();
        BarChart.legends = [];
        var filterValues = dimple.getUniqueValues(data, "Municipality");
        BarLegend.shapes.selectAll("rect")
          .on("click", function (e) {
            var hide = false;
            var newFilters = [];
            filterValues.forEach(function (f) {
              if (f === e.aggField.slice(-1)[0]) {
                hide = true;
              } else {
                newFilters.push(f);
              }
            });
            if (hide) {
              d3.select(this).style("opacity", 0.2);
            } else {
              newFilters.push(e.aggField.slice(-1)[0]);
              d3.select(this).style("opacity", 0.8);
            }
            filterValues = newFilters;
            BarChart.data = dimple.filterData(data, "Municipality", filterValues);
            BarChart.draw(800);
          });
		  
      });
  </script>
  </body>
  </html>